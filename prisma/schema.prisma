// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum KycStatus {
  pending
  verified
  rejected
}

enum TransactionType {
  deposit
  withdrawal
  earnings
  fiat_deposit
  usdc_conversion
}

enum TransactionStatus {
  pending
  completed
  failed
}

enum Currency {
  USD
  USDC
}

enum UserRole {
  user
  admin
}

enum ReportingFrequency {
  quarterly
  annual
}

model User {
  id                    Int                 @id @default(autoincrement())
  name                  String
  email                 String              @unique
  hashed_password       String?
  kyc_status            KycStatus           @default(pending)
  wallet_address        String?
  wallet_verified_at    DateTime?
  bank_connection_status Boolean             @default(false)
  role                  UserRole            @default(user)
  reporting_frequency   ReportingFrequency  @default(quarterly)
  created_at            DateTime            @default(now())
  updated_at            DateTime            @updatedAt
  portfolio             Portfolio?
  transactions          Transaction[]
  performance_reports   PerformanceReport[]
}

model Transaction {
  id          Int               @id @default(autoincrement())
  user        User              @relation(fields: [user_id], references: [id], onDelete: Cascade)
  user_id     Int
  type        TransactionType
  amount      Decimal
  currency    Currency
  status      TransactionStatus @default(pending)
  description String?
  created_at  DateTime          @default(now())
  updated_at  DateTime          @updatedAt
}

model Portfolio {
  id                      Int      @id @default(autoincrement())
  user                    User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  user_id                 Int      @unique
  usdc_balance            Decimal  @default(0)
  fund_share_percent      Decimal  @default(0)
  initial_investment      Decimal  @default(0)
  current_value           Decimal  @default(0)
  unrealized_gains        Decimal  @default(0)
  created_at              DateTime @default(now())
  updated_at              DateTime @updatedAt
}

model FundPerformance {
  id               Int      @id @default(autoincrement())
  date             DateTime @unique
  nav              Decimal
  aum              Decimal
  quarterly_return Decimal?
  ytd_return       Decimal?
  inception_return Decimal?
  created_at       DateTime @default(now())
}

model FundSnapshot {
  id         Int      @id @default(autoincrement())
  timestamp  DateTime
  quarter    String   // e.g., "2025-Q2"
  total_aum  Decimal  // total assets under management at snapshot time
  nav        Decimal  // net asset value per share
  created_at DateTime @default(now())
}

model PerformanceReport {
  id         Int      @id @default(autoincrement())
  user       User     @relation(fields: [user_id], references: [id])
  user_id    Int
  period     String   // e.g., "2025-Q2"
  gain_loss  Decimal
  created_at DateTime @default(now())
}
